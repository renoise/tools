<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" dir="ltr">
<head>
<title>Renoise Actions</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link type="text/css" href="/default.css" media="screen" rel="stylesheet" />

    <!-- required scripts -->
    <script type="text/javascript" src="/jquery.js"></script>
    <script type="text/javascript" src="/fg-menu/fg.menu.js"></script>

    <!-- required styles -->
    <link type="text/css" href="/fg-menu/fg.menu.css" media="screen" rel="stylesheet" />
    <link type="text/css" href="/fg-menu/theme/ui.all.css" media="screen" rel="stylesheet" />

    <!-- styles for this example page only -->
	<style type="text/css">
	#main, .fg-menu-container  { font-size:62.5%; }
	#menuLog { font-size:1.4em; margin:10px 20px 20px; }
	.hidden { position:absolute; top:0; left:-9999px; width:1px; height:1px; overflow:hidden; }

	.fg-button { clear:left; margin:0 4px 40px 20px; padding: .4em 1em; text-decoration:none !important; cursor:pointer; position: relative; text-align: center; zoom: 1; }
	.fg-button .ui-icon { position: absolute; top: 50%; margin-top: -8px; left: 50%; margin-left: -8px; }
	a.fg-button { float:left;  }
	button.fg-button { width:auto; overflow:visible; } /* removes extra button width in IE */

	.fg-button-icon-left { padding-left: 2.1em; }
	.fg-button-icon-right { padding-right: 2.1em; }
	.fg-button-icon-left .ui-icon { right: auto; left: .2em; margin-left: 0; }
	.fg-button-icon-right .ui-icon { left: auto; right: .2em; margin-left: 0; }
	.fg-button-icon-solo { display:block; width:8px; text-indent: -9999px; }	 /* solo icon buttons must have block properties for the text-indent to work */

	.fg-button.ui-state-loading .ui-icon { background: url(/fg-menu/spinner_bar.gif) no-repeat 0 0; }
	</style>

	<!-- style exceptions for IE 6 -->
	<!--[if IE]>
	<style type="text/css">
		.fg-menu-ipod .fg-menu li { width: 95%; }
		.fg-menu-ipod .ui-widget-content { border:0; }
	</style>
	<![endif]-->	
    
    <script type="text/javascript">
      var levels = 3;
      var dynamic = false;

      var path = new Array();
      var branch = null;
      var menu_tree = new Array();
      var address = "";

      function merge(subtree, tree){
         tree[branch] = subtree
      }

      function getMenu(){
        // DYNAMIC MENU ITEMS
          $.post("/actions.lua", {'path[]':path, full:dynamic, depth:levels}, function(subtree){
             //merge(subtree, menu_tree)
             
            $("#actions").html(subtree);
            $("#actions ul:first").attr('class','list_root');

        		$('#hierarchybreadcrumb').menu({
        			content : $("#actions").html(),
        			backLink: false,
        			callback: function(item){
        			   branch = $(item).text();
                  path.push(branch);
                  address = ""
                  $('.fg-menu-crumb').each(function(){
                     address += $(this).text() + "/";
                  });
                  address += branch;

                  $('#menuSelection').html("<a id='action_link' href='/"+ escape(address) + "'>"+branch+"</a>");

                  if (dynamic){ getMenu(); }
               }
        		});
          });
      }
  
      $(function(){

         $('#action_link').live('click',function(){
            var url = $(this).attr('href');
            $.post(url, {ajax:true});
            return false;
         });


         // MENU
         getMenu();

         // CONFIG
         if (!dynamic) { $('#config input[name="full"]').attr("checked", "checked"); }
         $('#config input[value=levels]').attr("checked", "checked");
         $('#levels').hide();

         $('#config input[name="full"]').click(function(){
            if ($(this).attr("checked")){
              $('#levels').hide();
            } else {
              $('#levels').show();
            }
            dynamic = $(this).attr("checked");
         });

         $('#config input[name="levels"]:checked').change(function(){
             levels = $(this).val();
         });
  
        	// BUTTONS
        	$('.fg-button').hover(
        		function(){ $(this).removeClass('ui-state-default').addClass('ui-state-focus'); },
        		function(){ $(this).removeClass('ui-state-focus').addClass('ui-state-default'); }
        	);
  
  
      });
    </script>
    
</head>

<body>
  <p><a href="/">Back to index</a></p>
  <h1>Menu for Renoise Actions with on-the-fly branch generation</h1>
  <p><small>... at least, that is the idea.</small></p>
  
  <p>The goal is to display a menu, initialized with only 1 level of items. As soon as the user clicks on an item, 
  the relevant branch is loaded and injected into the menu. Currently the server generates the tree as a HTML list,
  which makes injecting branches a bit hard/inefficient.</p>

   <p>Todo:</p>
  <ul>
   <li>Request branches and merge them in a local tree</li>
   <li>Execute Actions</li>
   <li>Add a special control for numbered Actions in the menu</li>
   <li>Show feedback from Renoise</li>
  </ul>


  <form id="config" action="#" style="color: #aaa">
    <fieldset>
       <legend>Config</legend>
       <p>(No user serviceable parts here for now)</p>
       <p id="full">Load the whole huge tree at once: <input type="checkbox" name="full" disabled="disabled" /></p>
       <p id="levels">Depth: 1<input type="radio" name="levels" value="1" /> 2 <input type="radio" name="levels" value="2" /> 3 <input type="radio" name="levels" value="3" /> 4 <input type="radio" name="levels" value="4" /></p>
     </fieldset>
  </form>

  <h2>The Menu</h2>

  <div id="main">
    <p>After choosing an Action from the menu, click the resulting link to execute it. Probably only Toggle type Actions will work.</p>
    <p id="menuLog">You chose: <span id="menuSelection"></span></p>

    <p><a tabindex="0" href="#actions" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="hierarchybreadcrumb"><span class="ui-icon ui-icon-triangle-1-s"> </span>Actions</a>
    </p>
  </div>

  <div id="actions" class="hidden"></div>



</body>
</html>